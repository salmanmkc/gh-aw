# GitHub Actions Workflow Layout Specification

> Auto-generated specification documenting patterns used in compiled `.lock.yml` files.
> Last updated: 2026-01-23

## Overview

This document catalogs all file paths, folder names, artifact names, and other patterns used across our compiled GitHub Actions workflows (`.lock.yml` files). The specification is based on analysis of **137 lock files** in the `.github/workflows/` directory.

## GitHub Actions

Common GitHub Actions used across workflows (24 unique external actions + 1 local action):

| Action | Version (SHA) | Description | Context |
|--------|---------------|-------------|---------|
| `./actions/setup` | Local | gh-aw setup action | Used in virtually all workflows to initialize the environment |
| `actions/checkout` | `93cb6efe18208431cddfb8368fd83d5badbf9bfd` | Checks out repository code | Used in almost all workflows for accessing repo content |
| `actions/upload-artifact` | `b7c566a772e6b6bfb58ed0dc250532a479d7789f` | Uploads build artifacts | Used for agent outputs, patches, prompts, and logs |
| `actions/download-artifact` | `018cc2cf5baa6db3ef3c5f8a56943fffe632ef53` | Downloads artifacts from previous jobs | Used in safe-output jobs and conclusion jobs |
| `actions/setup-node` | `395ad3262231945c25e8478fd5baf05154b1d79f` | Sets up Node.js environment | Used in workflows requiring npm/node |
| `actions/setup-node` | `6044e13b5dc448c55e2357c09f80417699197238` | Sets up Node.js environment (alternate version) | Older version still in use |
| `actions/github-script` | `ed597411d8f924073f98dfc5c65a23a2325f34cd` | Runs GitHub API scripts | Used for GitHub API interactions |
| `actions/github-script` | `f28e40c7f34bde8b3046d885e986cb6290c5673b` | Runs GitHub API scripts (alternate version) | Older version still in use |
| `actions/setup-python` | `a26af69be951a213d495a4c3e4e4022e16d87065` | Sets up Python environment | Used in workflows requiring Python |
| `actions/setup-go` | `4dc6199c7b1a012772edbd06daecab0f50c9053c` | Sets up Go environment | Used in workflows requiring Go |
| `actions/setup-go` | `7a3fe6cf4cb3a834922a1244abfce67bcef6a0c5` | Sets up Go environment (alternate version) | Older version still in use |
| `actions/cache` | `0057852bfaa89a56745cba8c7296529d2fc39830` | Cache dependencies | Used to cache dependencies for faster builds |
| `actions/cache/restore` | `0057852bfaa89a56745cba8c7296529d2fc39830` | Restore cached dependencies | Used for partial cache restoration |
| `actions/cache/save` | `0057852bfaa89a56745cba8c7296529d2fc39830` | Save dependencies to cache | Used for partial cache saving |
| `actions/create-github-app-token` | `29824e69f54612133e76f7eaac726eef6c875baf` | Creates GitHub App token | Used for authenticated GitHub API access |
| `actions/ai-inference` | `a6101c89c6feaecc585efdd8d461f18bb7896f20` | AI inference action | Used for AI model inference tasks |
| `astral-sh/setup-uv` | `d4b2f3b6ecc6e67c4457f6d3e41ec42d3d0fcb86` | Sets up uv package manager | Used for Python package management |
| `docker/setup-buildx-action` | `8d2750c68a42422c14e847fe6c8ac0403b4cbd6f` | Sets up Docker Buildx | Used for multi-platform Docker builds |
| `docker/login-action` | `c94ce9fb468520275223c153574b00df6fe4bcc9` | Logs in to Docker registry | Used for Docker registry authentication |
| `docker/metadata-action` | `c299e40c65443455700f0fdfc63efafe5b349051` | Extracts Docker metadata | Used for Docker image tagging |
| `docker/build-push-action` | `263435318d21b8e681c14492fe198d362a7d2c83` | Builds and pushes Docker images | Used for containerized workflows |
| `anchore/sbom-action` | `deef08a0db64bfad603422135db61477b16cef56` | Generates Software Bill of Materials | Used for security compliance |
| `github/stale-repos` | `3477b6488008d9411aaf22a0924ec7c1f6a69980` | Identifies stale repositories | Used for repository maintenance |
| `super-linter/super-linter` | `2bdd90ed3262e023ac84bf8fe35dc480721fc1f2` | Lints code across multiple languages | Used for code quality checks |
| `githubnext/gh-aw/actions/setup` | `623e612ff6a684e9a8634449508bdda21e2c178c` | gh-aw setup action (pinned version) | Used for specific workflow versions |

## Artifact Names

Artifacts uploaded/downloaded between workflow jobs (17 unique artifacts):

| Name | Upload | Download | Description | Context |
|------|--------|----------|-------------|---------|
| `agent-artifacts` | ‚úÖ | ‚úÖ | Complete agent execution artifacts | Contains all files generated by agent job |
| `agent-output` | ‚úÖ | ‚úÖ | AI agent execution output | Contains the agent's response and analysis |
| `agent_outputs` | ‚úÖ | - | Legacy agent outputs | Older naming convention, still in use |
| `safe-output` | ‚úÖ | - | Safe output processing results | Used for safe-output job results |
| `safe-outputs-assets` | ‚úÖ | ‚úÖ | Safe outputs asset files | Assets for GitHub API operations |
| `cache-memory` | ‚úÖ | ‚úÖ | Cache memory files | Persistent cache across workflow runs |
| `cache-memory-focus-areas` | ‚úÖ | ‚úÖ | Focused cache areas | Specialized cache for specific topics |
| `cache-memory-repo-audits` | ‚úÖ | ‚úÖ | Repository audit cache | Cache for repository analysis |
| `repo-memory-default` | ‚úÖ | ‚úÖ | Default repository memory | Standard repo memory storage |
| `repo-memory-campaigns` | ‚úÖ | ‚úÖ | Campaign repository memory | Memory for campaign workflows |
| `python-source-and-data` | ‚úÖ | - | Python source code and data | Python scripts and datasets |
| `data-charts` | ‚úÖ | - | Data visualization charts | Generated chart images |
| `trending-source-and-data` | ‚úÖ | - | Trending analysis data | Trending analysis results |
| `trending-charts` | ‚úÖ | - | Trending visualization charts | Charts for trending data |
| `sbom-artifacts` | ‚úÖ | - | Software Bill of Materials | Security compliance artifacts |
| `super-linter-log` | ‚úÖ | ‚úÖ | Super-linter execution logs | Code quality check logs |
| `threat-detection.log` | ‚úÖ | - | Security threat detection logs | Security analysis results |

## Common Job Names

Standard job names across workflows (20 unique job names):

| Job Name | Description | Context |
|----------|-------------|---------|
| `activation` | Determines if workflow should run | Uses skip-if-match and other filters |
| `pre_activation` | Pre-activation checks | Runs before main activation job |
| `agent` | Main AI agent execution job | Runs the copilot/claude/codex engine |
| `detection` | Post-agent analysis job | Analyzes agent output for patterns |
| `conclusion` | Final status reporting job | Runs after all other jobs complete |
| `safe_outputs` | Safe output processing job | Executes safe-output handlers |
| `config` | Configuration setup job | Initializes workflow configuration |
| `release` | Release management job | Handles release creation/updates |
| `upload_assets` | Asset upload job | Uploads assets to GitHub releases |
| `push_repo_memory` | Repository memory update job | Pushes memory updates to storage |
| `update_cache_memory` | Cache memory update job | Updates cache memory files |
| `check_ci_status` | CI status verification job | Checks CI/CD pipeline status |
| `check_external_user` | External user verification job | Validates external contributor access |
| `test_environment` | Test environment setup job | Prepares testing environment |
| `super_linter` | Code linting job | Runs super-linter for code quality |
| `ast_grep` | AST-based code search job | Searches code using AST patterns |
| `search_issues` | Issue search job | Searches GitHub issues |
| `post-issue` | Post-issue creation job | Creates issues based on workflow results |
| `post_to_slack_channel` | Slack notification job | Posts updates to Slack |
| `notion_add_comment` | Notion integration job | Adds comments to Notion pages |

## File Paths

Common file paths referenced in workflows:

### Environment Variables (Paths)

| Path | Description | Context |
|------|-------------|---------|
| `${{ env.GH_AW_AGENT_OUTPUT }}` | Agent output environment variable | Dynamic path to agent output |
| `${{ env.GH_AW_SAFE_OUTPUTS }}` | Safe outputs environment variable | Dynamic path to safe outputs |

### Fixed Paths

| Path | Description | Context |
|------|-------------|---------|
| `/tmp/gh-aw/` | Root temporary directory | Base directory for all temporary files |
| `/tmp/gh-aw/agent-stdio.log` | Agent stdio log file | Captures agent execution logs |
| `/tmp/gh-aw/aw-prompts/prompt.txt` | Prompt file | Stores agent prompt content |
| `/tmp/gh-aw/aw.patch` | Git patch file | Contains code changes from agent |
| `/tmp/gh-aw/aw_info.json` | Workflow info JSON | Metadata about workflow execution |
| `/tmp/gh-aw/cache-memory` | Cache memory directory | Cache storage location |
| `/tmp/gh-aw/cache-memory-focus-areas` | Focus areas cache | Specialized cache directory |
| `/tmp/gh-aw/cache-memory-repo-audits` | Repository audits cache | Audit cache directory |
| `/tmp/gh-aw/repo-memory/default` | Default repo memory | Standard memory storage |
| `/tmp/gh-aw/repo-memory/campaigns` | Campaign repo memory | Campaign memory storage |
| `/tmp/gh-aw/mcp-config/logs/` | MCP configuration logs | Model Context Protocol logs |
| `/tmp/gh-aw/mcp-logs/` | MCP server logs | MCP server execution logs |
| `/tmp/gh-aw/safe-inputs/logs/` | Safe inputs logs | Safe input processing logs |
| `/tmp/gh-aw/safeoutputs/` | Safe outputs directory | Safe output processing files |
| `/tmp/gh-aw/safeoutputs/assets/` | Safe outputs assets | Assets for safe outputs |
| `/tmp/gh-aw/sandbox/agent/logs/` | Sandbox agent logs | Agent sandbox execution logs |
| `/tmp/gh-aw/sandbox/firewall/logs/` | Sandbox firewall logs | Network firewall logs |
| `/tmp/gh-aw/threat-detection/` | Threat detection directory | Security analysis files |
| `/tmp/gh-aw/threat-detection/detection.log` | Threat detection log | Security analysis log |
| `/tmp/gh-aw/redacted-urls.log` | Redacted URLs log | Log of sanitized URLs |
| `/tmp/gh-aw/layout-cache` | Layout cache directory | Cache for layout patterns |
| `/tmp/gh-aw/prompt-cache` | Prompt cache directory | Cache for prompts |
| `/tmp/gh-aw/python/*.py` | Python scripts | Python source files |
| `/tmp/gh-aw/python/charts/*.png` | Python charts | Generated chart images |
| `/tmp/gh-aw/python/data/*` | Python data | Data files |
| `/opt/gh-aw/safe-jobs/` | Safe jobs directory | Safe job handler scripts |
| `sbom.cdx.json` | CycloneDX SBOM file | Software Bill of Materials |

## Working Directories

Common working directory patterns:

| Working Directory | Description | Context |
|-------------------|-------------|---------|
| `./actions/setup/js` | JavaScript actions directory | Used for JavaScript action execution |
| `actions/setup/js` | JavaScript actions (relative) | Alternative relative path |
| `./docs` | Documentation directory | Used for documentation builds |

## Folder Patterns

Key directories used across the codebase:

| Folder | Description | Context |
|--------|-------------|---------|
| `.github/workflows/` | Workflow files (source and compiled) | Primary location for all workflows |
| `.github/aw/` | Agentic workflow configuration | Contains actions-lock.json and other configs |
| `pkg/workflow/` | Workflow compilation code | Go package for compiling workflows |
| `pkg/cli/` | CLI command implementations | gh-aw command handlers |
| `pkg/parser/` | Markdown frontmatter parsing | Schema validation and parsing |
| `actions/setup/js/` | JavaScript runtime code | CommonJS modules for GitHub Actions |
| `actions/setup/sh/` | Shell script code | Bash scripts for GitHub Actions |
| `scratchpad/` | Specification documents | Documentation and specs directory |

## Constants and Patterns from Go Code

### Go Code Patterns

**File Path Patterns:**
```go
// Cache file paths
filepath.Join(repoRoot, ".github", "aw", CacheFileName)

// Lock file paths
filepath.Join(tmpDir, "test.lock.yml")

// Workflow file paths
filepath.Join(testDir, "test-workflow.md")

// Agent path resolution
filepath.Join(repoRoot, agentPath)
```

**Temporary Directory Patterns:**
```go
// Standard temp paths
"/tmp/gh-aw/agent-stdio.log"
"/tmp/gh-aw/mcp-config/logs/"
"/tmp/gh-aw/sandbox/agent/logs/"
"/tmp/gh-aw/sandbox/firewall/logs/"
```

**GitHub Context Patterns:**
```go
// Event name checks
"(github.event_name == 'issue_comment')"
"(github.event_name == 'issues')"
"(github.event_name == 'pull_request')"
"(github.event_name == 'pull_request_review_comment')"

// Event properties
"github.event.issue.body"
"github.event.pull_request.body"
"github.event.comment.body"
"github.event.pull_request.draft"
```

## JavaScript Patterns from Actions

### Common Patterns in `.cjs` Files

**Artifact References:**
```javascript
// Artifact location patterns
artifactLocation: { uri: finding.file }
core.setOutput("artifact_uploaded", "pending")

// Artifact download references
"agent-artifacts" // Downloaded artifacts
"/tmp/gh-aw/threat-detection/" // Artifact extraction location
```

**File Path Patterns:**
```javascript
// Patch file references
"agent-artifacts/tmp/gh-aw/aw.patch"
"gh run download ${runId} -n agent-artifacts"

// Artifact directory listings
"üìÅ Listing all files in artifact directory: " + artifactDir
```

## Usage Guidelines

### Artifact Naming
- **Format**: Use descriptive hyphenated names (e.g., `agent-output`, `mcp-logs`)
- **Consistency**: Upload and download names must match exactly
- **Legacy**: Some workflows use underscore naming (`agent_outputs`), but hyphens are preferred

### Job Naming
- **Format**: Use snake_case for job names (e.g., `create_pull_request`, `safe_outputs`)
- **Dependencies**: Jobs use `needs:` to declare dependencies on other jobs
- **Conditional**: Jobs can use `if:` conditions for conditional execution

### Path References
- **Relative paths**: Use relative paths from repository root (e.g., `./actions/setup`)
- **Environment variables**: Use GitHub Actions expressions for dynamic paths (e.g., `${{ env.GH_AW_AGENT_OUTPUT }}`)
- **Temporary files**: All temporary files go under `/tmp/gh-aw/` for consistency

### Action Pinning
- **Security**: Always pin actions to full commit SHA for security
- **Updates**: Update action SHAs through dependabot or manual review
- **Local actions**: Local actions use relative paths (e.g., `./actions/setup`)

### File Organization
- **Source files**: Markdown workflows in `.github/workflows/*.md`
- **Compiled files**: Lock files in `.github/workflows/*.lock.yml`
- **JavaScript**: Action scripts in `actions/setup/js/*.cjs`
- **Shell scripts**: Action scripts in `actions/setup/sh/*.sh`
- **Go code**: Compiler in `pkg/workflow/`

## Extraction Summary

- **Lock files analyzed**: 137
- **Actions cataloged**: 25 (24 external + 1 local)
- **Artifacts documented**: 17
- **Job patterns found**: 20
- **File paths listed**: 30+
- **Working directories**: 3

## Source Analysis

This specification was generated by analyzing:
1. All `.lock.yml` files in `.github/workflows/` using `yq` queries
2. Go code in `pkg/workflow/*.go` for path patterns and constants
3. JavaScript code in `actions/setup/js/*.cjs` for artifact patterns
4. File system structure for directory organization

---

*Auto-generated by Layout Specification Maintainer workflow - 2026-01-23*
